<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>L'appartement de Casablanca — Livret d'accueil</title>
  <meta name="description" content="Livret d'accueil numérique pour les voyageurs Airbnb à Casablanca : accès, Wi-Fi, parking, règles, recommandations locales, galerie photos et contact." />
  <meta name="theme-color" content="#0E3A5B" />
  <meta http-equiv="Permissions-Policy" content="clipboard-write=(self)">
  <!-- updated: system fonts first; webfonts optional via user agent -->
  <style>
    /* =========================
       Design System — Thème clair/sombre (Casablanca moderne)
       ========================= */
    :root{ /* updated */
      --brand:#0E3A5B; --brand-600:#134B73; --accent:#E85D5D;
      --bg:#F6F7FB; --card:#FFFFFF; --text:#111827; --muted:#6B7280; --border:#E5E7EB; --sand:#F5E9DA;
      --ring: 0 0 0 3px rgba(19,75,115,.28);
      --radius:16px; --radius-lg:24px;
      --shadow:0 6px 20px rgba(0,0,0,.08);
      --shadow-hover:0 10px 28px rgba(0,0,0,.12);
      --focus:2px solid rgba(19,75,115,.55);
      --trans-fast:150ms cubic-bezier(.2,.6,.2,1);
    }
    .dark, html.dark, body.dark{ /* updated */
      --bg:#0B1220; --card:#0F172A; --text:#E5E7EB; --muted:#9CA3AF; --border:#1F2A44; --sand:#0F172A;
      --ring: 0 0 0 3px rgba(232,93,93,.30);
      --shadow:0 6px 20px rgba(0,0,0,.55);
      --shadow-hover:0 10px 28px rgba(0,0,0,.6);
    }

    /* =========================
       Base
       ========================= */
    *{box-sizing:border-box;margin:0;padding:0}
    html:focus-within{scroll-behavior:smooth}
    body{font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background:var(--bg); color:var(--text); line-height:1.6}
    .serif{font-family: "DM Serif Display", "Playfair Display", ui-serif, Georgia, serif}
    .container{max-width:960px;margin:0 auto;min-height:100vh;background:var(--card);box-shadow:var(--shadow)} /* updated width */

    /* Skip link */
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{left:16px;top:16px;width:auto;height:auto;background:var(--card);padding:8px 12px;border-radius:8px;box-shadow:var(--shadow);outline:var(--focus)}

    /* =========================
       Header — translucide + blur
       ========================= */
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(10px);background:color-mix(in oklab, var(--card) 82%, transparent);border-bottom:1px solid var(--border);}
    .header-inner{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:14px 16px}
    h1{font-size:30px;line-height:1.2;color:var(--text)} /* updated scale */
    @media (max-width:520px){ h1{font-size:24px} }

    /* Lang + Owner + Theme controls */
    .cluster{display:flex;gap:8px;align-items:center}
    .lang button, .owner-btn, .btn, .theme-btn{ /* updated unified buttons */
      --_bg: #fff; --_fg: #1f2937; --_bd: var(--border);
      border:1px solid var(--_bd);background:var(--_bg);color:var(--_fg);
      border-radius:12px;padding:8px 12px;font-size:14px;cursor:pointer;transition:all var(--trans-fast);
    }
    .dark .lang button, .dark .owner-btn, .dark .btn, .dark .theme-btn{ --_bg:#0b1220; --_fg:var(--text); --_bd:var(--border)}
    .btn.solid{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn.solid:hover{background:var(--brand-600);box-shadow:var(--shadow-hover)}
    .btn.outline{background:transparent;border-color:var(--brand);color:var(--brand)}
    .btn.ghost{background:transparent;border-color:transparent}
    .btn:focus-visible{outline:var(--focus);box-shadow:var(--ring)}
    .lang button{min-width:44px}
    .lang button.active{border-color:var(--brand);color:var(--brand)}
    .owner-badge{font-size:12px;color:#16a34a;display:none}
    body.owner-on .owner-badge{display:inline}
    .owner-btn svg{margin-right:6px}

    /* Theme toggle */
    .theme-btn{display:inline-flex;align-items:center;gap:8px}

    /* =========================
       Hero — grand visuel
       ========================= */
    .hero{position:relative;height:320px;border-radius:var(--radius-lg);margin:16px;overflow:hidden;display:flex;align-items:flex-end;justify-content:flex-start;cursor:pointer; /* updated */
      background:
        radial-gradient(120% 120% at 80% 10%, rgba(0,0,0,.35) 0%, rgba(0,0,0,.55) 60%, rgba(0,0,0,.65) 100%),
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><rect width="1200" height="400" fill="%23E5E7EB"/><g fill="%23CBD5E1"><rect width="380" height="220" x="90" y="90" rx="16"/><rect width="220" height="180" x="520" y="120" rx="16"/><rect width="260" height="160" x="820" y="140" rx="16"/></g></svg>');
      background-size:cover;background-position:center}
    .hero input{display:none}
    .hero .overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;padding:24px;color:#fff}
    .hero h2{font-size:28px}
    .hero p{color:#E5E7EB;max-width:640px}
    .hero .cta{margin-top:12px}
    .badge{background:rgba(0,0,0,.55);color:#fff;border-radius:999px;padding:6px 10px;margin:12px;font-size:12px}
    .hero .badge{display:none}
    body.owner-on .hero .badge{display:inline-block}

    /* =========================
       Cards, sections & accordion
       ========================= */
    .section{padding-block:24px}
    .card{background:var(--card);margin:16px;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .card:hover{box-shadow:var(--shadow-hover)}
    .welcome{position:relative;top:-36px}
    .avatar{width:52px;height:52px;background:var(--brand);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;letter-spacing:.5px;margin-bottom:10px}
    .welcome h2{font-size:22px}
    .welcome p{color:var(--muted);font-size:15px}

    .accordion{padding:0 16px 16px}
    details.item{border:1px solid var(--border);border-radius:12px;margin-bottom:12px;overflow:clip;background:var(--card)}
    .item summary{list-style:none;padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none}
    .item summary::-webkit-details-marker{display:none}
    .item summary h3{font-size:18px;font-weight:700;flex:1}
    .item[open] summary{background:color-mix(in oklab, var(--card) 90%, var(--bg) 10%)}
    .chev{transition:transform var(--trans-fast)}
    .item[open] .chev{transform:rotate(180deg)}
    .item .body{padding:0 16px 16px;color:var(--text);animation:fadeSlide .18s ease}
    .item .body h4{font-size:16px;margin:12px 0 6px;display:flex;gap:8px;align-items:center}
    @keyframes fadeSlide{from{opacity:0;transform:translateY(-4px)} to{opacity:1;transform:translateY(0)}}

    /* Lists */
    .list{padding-left:0}
    .list li{margin:8px 0;list-style:none;position:relative;padding-left:22px;color:var(--text)}
    .list li:before{content:"";position:absolute;left:0;top:.65em;width:10px;height:10px;border:2px solid var(--brand-600);border-radius:999px}
    .muted{color:var(--muted)}

    /* Photo zones */
    .photo-drop{background:color-mix(in oklab, var(--bg) 86%, #fff 14%);border:2px dashed var(--border);border-radius:10px;padding:16px;text-align:center;margin:10px 0;color:var(--muted);cursor:pointer;transition:border-color var(--trans-fast), background var(--trans-fast)}
    .photo-drop:hover{border-color:var(--brand)}
    .photo-drop.has-image{border-style:solid;border-color:var(--border);background:var(--card);padding:0}
    .photo-preview{position:relative}
    .photo-preview img{width:100%;display:block;border-radius:8px}
    .photo-actions{position:absolute;top:8px;right:8px;display:flex;gap:6px}
    .pill{background:rgba(0,0,0,.6);color:#fff;border:none;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer}

    .photo-drop:not(.has-image){display:none}
    body.owner-on .photo-drop:not(.has-image){display:block}

    /* Secret pills */
    .secret{display:flex;align-items:center;gap:10px;margin:6px 0;flex-wrap:wrap}
    .secret code{background:var(--card);border:1px solid var(--border);padding:7px 10px;border-radius:10px;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;position:relative}
    .secret .reveal{display:inline-flex;align-items:center;gap:6px}
    .icon-btn{border:1px solid var(--border);background:var(--card);border-radius:10px;padding:6px 10px;font-size:12px;cursor:pointer;display:inline-flex;gap:6px;align-items:center}
    .icon-btn:hover{border-color:var(--brand)}
    .icon-btn:focus-visible{outline:var(--focus)}

    /* Wi-Fi */
    .wifi{background:color-mix(in oklab, var(--brand) 6%, var(--bg) 94%);border-left:4px solid var(--brand);padding:14px;border-radius:12px;margin:10px 0}

    /* Map card */
    .map-wrap{margin:10px 0;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);border:1px solid var(--border)}
    .map-wrap header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:color-mix(in oklab, var(--card) 90%, var(--bg) 10%);border-bottom:1px solid var(--border);backdrop-filter:none;position:static}
    .map-wrap iframe{width:100%;height:300px;border:0}

    /* Galerie / Slider */
    .gallery-card .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
    .gallery-card .btn{border:1px solid var(--border);background:var(--card);border-radius:10px;padding:8px 12px;cursor:pointer;font-size:14px}
    .slider{position:relative;border-radius:12px;overflow:hidden;box-shadow:var(--shadow);background:#000}
    .slides{display:flex;transition:transform .35s ease;touch-action:pan-y}
    .slide{min-width:100%;height:0;padding-top:56.25%;position:relative;background:#000} /* 16:9 */
    .slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .caption{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(transparent,rgba(0,0,0,.55));color:#fff;font-size:13px;padding:10px 12px}
    .ctrl{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.18);backdrop-filter:blur(4px);border:none;color:#fff;border-radius:999px;width:40px;height:40px;cursor:pointer;display:grid;place-items:center}
    .ctrl.prev{left:8px}.ctrl.next{right:8px}
    .ctrl:focus-visible{outline:var(--focus)}
    .dots{display:flex;gap:8px;justify-content:center;padding:10px}
    .dot{width:10px;height:10px;border-radius:999px;background:#cbd5e1;opacity:.8}
    .dot.active{background:#2563eb;opacity:1}
    .thumbs{display:grid;grid-template-columns:repeat(auto-fill,minmax(84px,1fr));gap:8px;margin-top:10px}
    .thumbs .t{position:relative;border-radius:10px;overflow:hidden;cursor:pointer;border:2px solid transparent}
    .thumbs .t.active{border-color:#2563eb}
    .thumbs img{display:block;width:100%;height:70px;object-fit:cover}
    .badge-edit{position:absolute;top:6px;right:6px;display:flex;gap:6px}
    .badge-edit .mini{background:rgba(0,0,0,.7);color:#fff;border:none;border-radius:999px;padding:4px 8px;font-size:12px;cursor:pointer}
    .gallery-empty{display:none}

    /* Slider autoplay progress */
    .progress{position:absolute;left:0;right:0;bottom:0;height:3px;background:rgba(255,255,255,.25);}
    .progress .bar{height:100%;width:0;background:#fff;transition:width linear}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:60}
    .modal .box{background:var(--card);border-radius:12px;min-width:300px;max-width:92vw;padding:16px;box-shadow:0 16px 40px rgba(0,0,0,.35);border:1px solid var(--border)}
    .modal h4{margin-bottom:10px}
    .modal .row{display:flex;gap:8px}
    .modal input{flex:1;border:1px solid var(--border);border-radius:8px;padding:8px 10px;background:var(--card);color:var(--text)}
    .modal .btn{border:1px solid var(--border);background:var(--card);border-radius:10px;padding:8px 12px;cursor:pointer}

    /* Toast */
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 12px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:70}
    .toast.show{opacity:0.95}

    /* Footer */
    footer{padding:18px 16px;text-align:center;color:var(--muted);font-size:12px;background:var(--sand);border-top:1px solid var(--border)}
    .dark footer{background:#0E1424}

    /* Print */
    @media print{header,.lang,.photo-actions,.theme-btn,.badge,.ctrl,.dots,.thumbs,.progress,.badge-edit,[data-edit-only]{display:none!important} .container{box-shadow:none} .card,.item{break-inside:avoid} a[href]:after{content:" (" attr(href) ")"}}

    /* Motion safety */
    @media (prefers-reduced-motion: reduce){ *{animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; scroll-behavior:auto !important}}
  </style>
</head>
<body>
  <a class="skip-link" href="#accordion">Aller au contenu</a> <!-- updated -->
  <div class="container" id="app">
    <header>
      <div class="header-inner">
        <h1 class="serif" data-i18n="title">L'appartement de Casablanca</h1>
        <div class="cluster">
          <div class="lang" aria-label="Sélecteur de langue">
            <button id="btn-fr" class="active" data-lang="fr" aria-pressed="true">FR</button>
            <button id="btn-en" data-lang="en" aria-pressed="false">EN</button>
          </div>
          <!-- updated: theme toggle -->
          <button class="theme-btn btn outline" id="themeToggle" aria-pressed="false" title="Basculer clair / sombre" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
            <span data-i18n="themeBtn">Thème</span>
          </button>
          <div class="owner-ctrl">
            <span class="owner-badge">● Mode propriétaire</span>
            <button id="ownerBtn" class="owner-btn" title="Activer l'édition (mot de passe)" type="button" role="button">
              <!-- updated: SVG icon -->
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M18 11H6a2 2 0 00-2 2v5a2 2 0 002 2h12a2 2 0 002-2v-5a2 2 0 00-2-2z"/><path d="M8 11V7a4 4 0 118 0v4"/></svg>
              <span id="ownerBtnLabel" data-i18n="ownerLogin">Connexion propriétaire</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Modal mot de passe propriétaire -->
    <div class="modal" id="ownerModal" role="dialog" aria-modal="true" aria-labelledby="ownerTitle">
      <div class="box">
        <h4 id="ownerTitle">Mot de passe propriétaire</h4>
        <div class="row" style="margin-bottom:8px">
          <input id="ownerPwd" type="password" placeholder="Entrez le mot de passe" autocomplete="current-password"/>
          <button class="btn" id="ownerOk" type="button">Valider</button>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:8px">
          <button class="btn" id="ownerCancel" type="button">Annuler</button>
        </div>
      </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <div class="hero" id="hero" title="Ajouter une photo principale" role="img" aria-label="Photo principale" tabindex="0">
      <input type="file" id="heroInput" accept="image/*" />
      <div class="overlay" aria-hidden="true"> <!-- updated -->
        <h2 class="serif" data-i18n="welcomeTitle">Bienvenue dans \"L'appartement de Casablanca\"</h2>
        <p class="muted" data-i18n="welcomeBody">Nous sommes ravis de vous avoir comme invité. Vous trouverez ci-dessous toutes les informations essentielles pour rendre votre visite confortable.</p>
        <div class="cta">
          <a class="btn solid" href="#section-access" role="button" data-i18n="startCta">Commencer</a>
        </div>
      </div>
      <span class="badge" data-i18n="clickToAdd">Cliquez pour changer la photo</span>
    </div>

    <section class="card welcome">
      <div class="avatar" aria-hidden="true">QM</div>
      <h2 class="serif" data-i18n="welcomeTitle">Bienvenue dans "L'appartement de Casablanca"</h2>
      <p data-i18n="welcomeBody">Nous sommes ravis de vous avoir comme invité. Vous trouverez ci-dessous toutes les informations essentielles pour rendre votre visite confortable.</p>
    </section>

    <section class="accordion section" id="accordion">
      <!-- Accès -->
      <details class="item" open id="section-access"> <!-- updated: anchor id -->
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="access">Accès à la propriété</h3>
        </summary>
        <div class="body">
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1118 0z"/><circle cx="12" cy="10" r="3"/></svg> <span data-i18n="address">Adresse</span></h4>
          <p>H82G+63W, Rte du complexe Administratif, Casablanca 20240, Maroc</p>
          <div class="map-wrap">
            <header>
              <strong data-i18n="locationTitle">Localisation</strong>
              <div class="cluster">
                <a id="mapOpen" class="btn outline" style="text-decoration:none" href="#" target="_blank" rel="noopener"><span data-i18n="openMaps">Ouvrir dans Google Maps</span></a>
                <a id="mapDirections" class="btn outline" style="text-decoration:none" href="#" target="_blank" rel="noopener"><span data-i18n="directions">Itinéraire</span></a>
              </div>
            </header>
            <iframe id="mapFrame" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src=""></iframe>
          </div>

          <!-- Photo entrée -->
          <div class="photo-drop" data-photo="access-entry">
            <input type="file" accept="image/*" hidden />
            <span data-i18n="addPhotoEntry">Cliquez pour ajouter une photo de l'entrée</span> <!-- updated: no emoji -->
          </div>

          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg> <span data-i18n="keys">Récupération des clés</span></h4>
          <ul class="list">
            <li data-i18n="mailboxLoc">Devant la porte principale, ouvrez la boîte aux lettres.</li>
            <li>
              <div class="secret">
                <strong data-i18n="mailboxCode">Code de la boîte aux lettres:</strong>
                <code data-secret="true" data-value="755" title="Cliquer pour révéler">••••••</code>
                <button class="icon-btn" data-copy="#" aria-label="Copier le code">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2"/><rect x="2" y="2" width="13" height="13" rx="2"/></svg>
                  Copier
                </button>
                <button class="icon-btn reveal" data-reveal="#" aria-label="Révéler / masquer">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/><circle cx="12" cy="12" r="3"/></svg>
                  Afficher
                </button>
              </div>
            </li>
            <li data-i18n="pickupKey">Récupérez la clé de l'appartement.</li>
            <li><span data-i18n="floor">Appartement situé au</span> <strong>1er étage</strong> — <span data-i18n="elevator">ascenseur disponible</span>.</li>
          </ul>

          <!-- Photo boîte aux lettres -->
          <div class="photo-drop" data-photo="access-mailbox">
            <input type="file" accept="image/*" hidden />
            <span data-i18n="addPhotoMailbox">Cliquez pour ajouter une photo de la boîte aux lettres</span>
          </div>
        </div>
      </details>

      <!-- Galerie -->
      <details class="item gallery-card">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="galleryTitle">Photos de l'appartement</h3>
        </summary>
        <div class="body">
          <div class="toolbar" data-edit-only>
            <button class="btn" id="gal-add" type="button" data-i18n="galleryAdd">Ajouter des photos</button>
            <input type="file" id="gal-input" accept="image/*" multiple hidden>
            <button class="btn" id="gal-edit" type="button" data-i18n="galleryEdit">Mode édition : OFF</button>
            <button class="btn" id="gal-clear" type="button" data-i18n="galleryClear">Tout supprimer</button>
          </div>
          <div class="slider" id="slider" aria-label="Galerie de photos">
            <div class="slides" id="slides"></div>
            <button class="ctrl prev" id="prev" aria-label="Précédent" type="button">‹</button>
            <button class="ctrl next" id="next" aria-label="Suivant" type="button">›</button>
            <div class="progress" aria-hidden="true"><div class="bar" id="autoBar"></div></div> <!-- updated -->
            <div class="dots" id="dots"></div>
          </div>
          <div class="thumbs" id="thumbs" aria-label="Miniatures"></div>
        </div>
      </details>

      <!-- Parking -->
      <details class="item">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="parkingTitle">Informations de stationnement</h3>
        </summary>
        <div class="body">
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 18V8a3 3 0 013-3h7a3 3 0 013 3v10"/><path d="M6 18h12a3 3 0 003-3v-3a3 3 0 00-3-3H6"/></svg> <span data-i18n="parking">Parking sous-sol</span></h4>
          <ul class="list">
            <li><span data-i18n="parkingSpot">Emplacement :</span> <strong>-2, place 11A</strong></li>
            <li data-i18n="remoteInFlat">Télécommande disponible dans l'appartement.</li>
            <li data-i18n="parkingFree">Parking gratuit inclus dans votre séjour.</li>
          </ul>

          <div class="photo-drop" data-photo="parking">
            <input type="file" accept="image/*" hidden />
            <span data-i18n="addPhotoParking">Cliquez pour ajouter une photo du parking</span>
          </div>
        </div>
      </details>

      <!-- Wi-Fi -->
      <details class="item">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="wifiTitle">Détails Wi‑Fi</h3>
        </summary>
        <div class="body">
          <div class="wifi">
            <div class="secret">
              <strong data-i18n="wifiSsid">SSID:</strong>
              <code id="wifiSsid">Orange_wifi_BFAD</code>
              <button class="icon-btn" data-copy="Orange_wifi_BFAD" aria-label="Copier le SSID">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><rect x="2" y="2" width="13" height="13" rx="2"/></svg>
                Copier
              </button>
            </div>
            <div class="secret">
              <strong data-i18n="wifiPwd">Mot de passe:</strong>
              <code id="wifiPwdCode" data-secret="true" data-value="A3FEq27tYN2Y" title="Cliquer pour révéler">••••••••••••</code>
              <button class="icon-btn" data-copy="#">Copier</button>
              <button class="icon-btn reveal" data-reveal="#" aria-label="Révéler / masquer">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/><circle cx="12" cy="12" r="3"/></svg>
                Afficher
              </button>
              <button class="icon-btn" id="wifiQrBtn" aria-haspopup="dialog" data-i18n="wifiQr">QR Code</button> <!-- updated -->
            </div>
          </div>
        </div>
      </details>

      <!-- Check-out -->
      <details class="item">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="checkoutTitle">Instructions de check-out</h3>
        </summary>
        <div class="body">
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> <span data-i18n="leaveBefore">Départ : Avant midi</span></h4>
          <p data-i18n="respectTime">Nous comptons sur vous pour respecter l'horaire.</p>
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.86 19.86 0 01-8.63-3.07A19.5 19.5 0 013.07 12.8 19.86 19.86 0 010 4.18 2 2 0 012 2h3a2 2 0 012 1.72 12.44 12.44 0 00.7 2.81 2 2 0 01-.45 2.11L6.2 9.8a16 16 0 006 6l1.16-1.06a2 2 0 012.11-.45 12.44 12.44 0 002.81.7A2 2 0 0122 16.92z"/></svg> <span data-i18n="notifyUs">Prévenez-nous</span></h4>
          <p data-i18n="notifyText">Informez-nous de l'heure de votre départ pour mieux organiser l'accueil des prochains voyageurs.</p>
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 19a2 2 0 01-2 2H5a2 2 0 01-2-2"/><path d="M7 17V8a5 5 0 0110 0v9"/><rect x="5" y="17" width="14" height="4" rx="2"/></svg> <span data-i18n="beforeLeaving">Que faire avant de partir ?</span></h4>
          <ul class="list">
            <li data-i18n="lockDoor">Fermez bien la porte derrière vous.</li>
            <li data-i18n="dropKeys">Déposez les clés dans la petite boîte prévue à cet effet.</li>
            <li data-i18n="turnOff">Éteignez les lumières, la climatisation et la plaque vitrocéramique.</li>
          </ul>
          <p><strong data-i18n="thanks">Merci de votre coopération, et bon voyage !</strong></p>
        </div>
      </details>

      <!-- Équipements -->
      <details class="item">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="amenitiesTitle">Fonctionnalités de l'appartement</h3>
        </summary>
        <div class="body">
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="14" rx="2"/><path d="M9 21h6"/></svg> <span data-i18n="amenities">Équipements disponibles</span></h4>
          <ul class="list">
            <li>Cuisine équipée (réfrigérateur, four, micro-ondes, cuisinière)</li>
            <li>Lave-linge, fer à repasser</li>
            <li>Climatisation et chauffage</li>
            <li>Télévision, système audio</li>
            <li>Espace de travail dédié avec Wi-Fi</li>
            <li>Sèche-cheveux, produits d'hygiène fournis</li>
            <li>Serviettes, draps et essentiels inclus</li>
          </ul>

          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 19V5h12v14"/><path d="M6 9h12"/></svg> <span data-i18n="kitchen">Cuisine</span></h4>
          <ul class="list">
            <li>Cafetière, bouilloire électrique, grille-pain</li>
            <li>Ustensiles de base (casseroles, poêles, vaisselle)</li>
            <li>Cuiseur à riz</li>
            <li>Café fourni</li>
          </ul>

          <div class="photo-drop" data-photo="amenity">
            <input type="file" accept="image/*" hidden />
            <span data-i18n="addPhotoAmenity">Cliquez pour ajouter une photo d'équipement</span>
          </div>
        </div>
      </details>

      <!-- Recos locales -->
      <details class="item">
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3 data-i18n="localTitle">Recommandations locales</h3>
        </summary>
        <div class="body">
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20"/><path d="M2 12h20"/></svg> <span data-i18n="transport">Transport</span></h4>
          <ul class="list">
            <li data-i18n="tram">Tramway : station à ~10 min à pied.</li>
            <li data-i18n="redTaxi">Taxi rouge : demandez l'activation du compteur (5–6 km ≈ 10 DH).</li>
            <li data-i18n="apps">Applications VTC : InDrive, Careem.</li>
          </ul>
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7h18M8 7v13M16 7v13M3 20h18"/></svg> <span data-i18n="groceries">Courses</span></h4>
          <ul class="list">
            <li>Marjane, BIM, Carrefour Market.</li>
            <li>Kazyon Assafa et Carrefour Market à &lt; 5 min.</li>
          </ul>
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v14H3z"/><path d="M7 21h10"/></svg> <span data-i18n="fastFood">Restauration rapide</span></h4>
          <ul class="list"><li>KFC à ~200 m — ouvert jusqu'à minuit.</li></ul>
          <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M7 8h10M7 12h10M7 16h6"/></svg> <span data-i18n="delivery">Livraison</span></h4>
          <ul class="list"><li>Kooul, Glovo, etc.</li></ul>

          <div class="photo-drop" data-photo="neighborhood">
            <input type="file" accept="image/*" hidden />
            <span data-i18n="addPhotoArea">Cliquez pour ajouter une photo du quartier</span>
          </div>
        </div>
      </details>

      <!-- Paramètres (propriétaire) : Générateur SHA-256 -->
      <details class="item" data-edit-only>
        <summary>
          <svg class="chev" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          <h3>Paramètres (propriétaire)</h3>
        </summary>
        <div class="body">
          <h4>Sécurité — Générer le SHA-256</h4>
          <div style="display:grid;gap:8px;grid-template-columns:1fr auto;align-items:center">
            <input id="pwdPlain" type="text" placeholder="Entrez le nouveau mot de passe à hasher"
                   style="border:1px solid var(--border);border-radius:8px;padding:8px 10px;background:var(--card);color:var(--text)">
            <button class="owner-btn" id="btnGenHash" type="button">Générer</button>
          </div>
          <div class="secret" style="margin-top:8px;flex-wrap:wrap">
            <strong>SHA-256 :</strong>
            <code id="hashOut" style="max-width:100%;overflow:auto">—</code>
            <button class="icon-btn" id="btnCopyHash">Copier</button>
            <button class="icon-btn" id="btnApplyLocal">Activer localement (test)</button>
          </div>
          <p class="muted" style="font-size:13px;margin-top:6px">
            • <b>Production :</b> copie le hash ci-dessus et remplace la constante <code>OWNER_HASH_CONST</code> dans ton code, puis redeploie.<br>
            • <b>Test local :</b> “Activer localement” crée un override (valable uniquement sur <em>ce</em> navigateur).
          </p>
        </div>
      </details>
    </section>

    <footer>
      <p data-i18n="footerLine1">Bon séjour à Casablanca !</p>
      <p style="margin-top:6px;font-size:11px"><span data-i18n="footerTip">Astuce : enregistrez cette page sur votre téléphone pour y accéder hors‑ligne.</span></p>
    </footer>
  </div>

  <!-- Wi-Fi QR Modal (updated) -->
  <div class="modal" id="wifiQrModal" role="dialog" aria-modal="true" aria-labelledby="wifiQrTitle">
    <div class="box">
      <h4 id="wifiQrTitle">QR Code Wi‑Fi</h4>
      <p class="muted" style="margin-bottom:8px">Scannez pour vous connecter au réseau.</p>
      <canvas id="wifiQrCanvas" width="256" height="256" style="display:block;margin:0 auto 12px;border-radius:8px;border:1px solid var(--border);background:#fff"></canvas>
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button class="btn" id="wifiQrClose" type="button">Fermer</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       Const & helpers
       ========================= */
    const OWNER_HASH_CONST = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9'; // SHA-256 de "admin123" (remplace-moi)
    const LS_OWNER       = 'owner:mode';
    const LS_OWNER_HASH  = 'owner:hash:override';
    let ownerMode = false;

    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>[...r.querySelectorAll(s)];
    const toastBox = ()=>document.getElementById('toast');
    function toast(msg){ const t=toastBox(); if(!t) return; t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }

    /* Focus ring polyfill for mouse users off (optional) */

    /* =========================
       Thème clair / sombre (updated)
       ========================= */
    (function theme(){
      const root = document.documentElement;
      const saved = localStorage.getItem('theme');
      if(saved==='dark' || (saved===null && window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches)){
        root.classList.add('dark');
        $('#themeToggle')?.setAttribute('aria-pressed','true');
      }
      $('#themeToggle')?.addEventListener('click',()=>{
        const isDark = root.classList.toggle('dark');
        localStorage.setItem('theme', isDark?'dark':'light');
        $('#themeToggle')?.setAttribute('aria-pressed', String(isDark));
      });
    })();

    /* Header shadow on scroll (subtle) */
    (function headerScroll(){
      const hdr=document.querySelector('header');
      let last=0; const on=()=>{ const y=window.scrollY; hdr.style.boxShadow = y>4? 'var(--shadow)': 'none'; last=y; };
      on(); window.addEventListener('scroll', on, {passive:true});
    })();

    /* =========================
       Owner mode
       ========================= */
    async function sha256(txt){ const enc=new TextEncoder().encode(txt); const buf=await crypto.subtle.digest('SHA-256', enc); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
    function getActiveOwnerHash(){ return localStorage.getItem(LS_OWNER_HASH) || OWNER_HASH_CONST; }
    function setOwnerUI(on){
      ownerMode = !!on;
      document.body.classList.toggle('owner-on', ownerMode);
      $('#ownerBtn').textContent = ownerMode ? 'Déconnexion propriétaire' : 'Connexion propriétaire'; /* updated: text only */
      refreshPhotoDropsVisibility();
      refreshGalleryVisibility();
    }
    function restoreOwner(){ setOwnerUI(localStorage.getItem(LS_OWNER)==='1'); }
    function bindOwner(){
      const btn = $('#ownerBtn');
      const modal = $('#ownerModal');
      const ok = $('#ownerOk');
      const cancel = $('#ownerCancel');
      const pwd = $('#ownerPwd');
      btn.addEventListener('click',()=>{
        if(ownerMode){ if(confirm('Désactiver le mode propriétaire ?')){ localStorage.removeItem(LS_OWNER); setOwnerUI(false); toast('Mode lecture'); } return; }
        modal.style.display='flex'; pwd.value=''; pwd.focus();
      });
      cancel.addEventListener('click',()=>{ modal.style.display='none'; });
      modal.addEventListener('click',(e)=>{ if(e.target===modal) modal.style.display='none'; });
      ok.addEventListener('click', async ()=>{
        const h = await sha256(pwd.value||'');
        if(h===getActiveOwnerHash()){
          localStorage.setItem(LS_OWNER,'1'); setOwnerUI(true); modal.style.display='none'; toast('Mode édition activé');
        }else{ toast('Mot de passe incorrect'); pwd.focus(); }
      });
      pwd.addEventListener('keydown',e=>{ if(e.key==='Enter') ok.click(); });
    }

    /* =========================
       i18n (fixed & complete)
       ========================= */
    const DICT={
      fr:{
        title:"L'appartement de Casablanca",
        themeBtn:"Thème",
        ownerLogin:"Connexion propriétaire",
        clickToAdd:"Cliquez pour changer la photo",
        welcomeTitle:"Bienvenue dans \"L'appartement de Casablanca\"",
        welcomeBody:"Nous sommes ravis de vous avoir comme invité. Vous trouverez ci-dessous toutes les informations essentielles pour rendre votre visite confortable.",
        startCta:"Commencer",
        access:"Accès à la propriété",
        address:"Adresse",
        keys:"Récupération des clés",
        mailboxLoc:"Devant la porte principale, ouvrez la boîte aux lettres.",
        mailboxCode:"Code de la boîte aux lettres:",
        pickupKey:"Récupérez la clé de l'appartement.",
        floor:"Appartement situé au",
        elevator:"ascenseur disponible",
        addPhotoEntry:"Cliquez pour ajouter une photo de l'entrée",
        addPhotoMailbox:"Cliquez pour ajouter une photo de la boîte aux lettres",
        galleryTitle:"Photos de l'appartement",
        galleryAdd:"Ajouter des photos",
        galleryEdit:"Mode édition : OFF",
        galleryClear:"Tout supprimer",
        parkingTitle:"Informations de stationnement",
        parking:"Parking sous-sol",
        parkingSpot:"Emplacement :",
        remoteInFlat:"Télécommande disponible dans l'appartement.",
        parkingFree:"Parking gratuit inclus dans votre séjour.",
        addPhotoParking:"Cliquez pour ajouter une photo du parking",
        wifiTitle:"Détails Wi‑Fi",
        wifiSsid:"SSID:",
        wifiPwd:"Mot de passe:",
        wifiQr:"QR Code",
        checkoutTitle:"Instructions de check-out",
        leaveBefore:"Départ : Avant midi",
        respectTime:"Nous comptons sur vous pour respecter l'horaire.",
        notifyUs:"Prévenez-nous",
        notifyText:"Informez-nous de l'heure de votre départ pour mieux organiser l'accueil des prochains voyageurs.",
        beforeLeaving:"Que faire avant de partir ?",
        lockDoor:"Fermez bien la porte derrière vous.",
        dropKeys:"Déposez les clés dans la petite boîte prévue à cet effet.",
        turnOff:"Éteignez les lumières, la climatisation et la plaque vitrocéramique.",
        thanks:"Merci de votre coopération, et bon voyage !",
        amenitiesTitle:"Fonctionnalités de l'appartement",
        amenities:"Équipements disponibles",
        kitchen:"Cuisine",
        addPhotoAmenity:"Cliquez pour ajouter une photo d'équipement",
        rulesTitle:"Règles de la maison",
        noSmoke:"Interdiction de fumer",
        noSmokeTxt:"Pas de fumée à l'intérieur, s'il vous plaît !",
        quietHours:"Respect du voisinage",
        quietTime:"Silence de 21h à 3h.",
        beKind:"Faites preuve de considération envers vos voisins.",
        noParty:"Événements et fêtes interdits",
        noPartyTxt:"Merci de préserver la tranquillité des lieux.",
        guestsOnly:"Accès restreint",
        guestsOnlyTxt:"Seuls les voyageurs indiqués dans la réservation sont autorisés.",
        localTitle:"Recommandations locales",
        transport:"Transport",
        tram:"Tramway : station à ~10 min à pied.",
        redTaxi:"Taxi rouge : demandez l'activation du compteur (5–6 km ≈ 10 DH).",
        apps:"Applications VTC : InDrive, Careem.",
        groceries:"Courses",
        fastFood:"Restauration rapide",
        delivery:"Livraison",
        addPhotoArea:"Cliquez pour ajouter une photo du quartier",
        locationTitle:"Localisation",
        openMaps:"Ouvrir dans Google Maps",
        directions:"Itinéraire",
        footerLine1:"Bon séjour à Casablanca !",
        footerTip:"Astuce : enregistrez cette page sur votre téléphone pour y accéder hors‑ligne."
      },
      en:{
        title:"Casablanca Apartment",
        themeBtn:"Theme",
        ownerLogin:"Owner login",
        clickToAdd:"Click to change photo",
        welcomeTitle:"Welcome to the \"Casablanca Apartment\"",
        welcomeBody:"We're delighted to host you. Below is everything you need for a comfortable stay.",
        startCta:"Get started",
        access:"Property Access",
        address:"Address",
        keys:"Key pickup",
        mailboxLoc:"At the main door, open the mailbox.",
        mailboxCode:"Mailbox code:",
        pickupKey:"Retrieve the apartment key.",
        floor:"Apartment on the",
        elevator:"elevator available",
        addPhotoEntry:"Click to add an entrance photo",
        addPhotoMailbox:"Click to add a mailbox photo",
        galleryTitle:"Apartment photos",
        galleryAdd:"Add photos",
        galleryEdit:"Edit mode: OFF",
        galleryClear:"Delete all",
        parkingTitle:"Parking information",
        parking:"Underground parking",
        parkingSpot:"Spot:",
        remoteInFlat:"Remote is available in the apartment.",
        parkingFree:"Parking included in your stay.",
        addPhotoParking:"Click to add a parking photo",
        wifiTitle:"Wi‑Fi details",
        wifiSsid:"SSID:",
        wifiPwd:"Password:",
        wifiQr:"QR Code",
        checkoutTitle:"Check-out instructions",
        leaveBefore:"Check-out: before noon",
        respectTime:"Please respect the timing.",
        notifyUs:"Let us know",
        notifyText:"Tell us your departure time so we can prepare for the next guests.",
        beforeLeaving:"Before leaving",
        lockDoor:"Lock the door behind you.",
        dropKeys:"Drop the keys in the small box.",
        turnOff:"Turn off lights, AC and cooktop.",
        thanks:"Thank you and have a great trip!",
        amenitiesTitle:"Apartment amenities",
        amenities:"Available amenities",
        kitchen:"Kitchen",
        addPhotoAmenity:"Click to add an amenity photo",
        rulesTitle:"House rules",
        noSmoke:"No smoking",
        noSmokeTxt:"No smoking inside, please.",
        quietHours:"Quiet hours",
        quietTime:"Quiet from 9pm to 3am.",
        beKind:"Please be considerate to neighbours.",
        noParty:"No parties or events",
        noPartyTxt:"Keep the place peaceful.",
        guestsOnly:"Guests only",
        guestsOnlyTxt:"Only guests on the reservation are allowed.",
        localTitle:"Local tips",
        transport:"Transport",
        tram:"Tram station ~10 min walk.",
        redTaxi:"Red taxi: ask driver to turn on the meter (5–6 km ≈ 10 DH).",
        apps:"Ride-hailing: InDrive, Careem.",
        groceries:"Groceries",
        fastFood:"Fast food",
        delivery:"Delivery",
        addPhotoArea:"Click to add a neighborhood photo",
        locationTitle:"Location",
        openMaps:"Open in Google Maps",
        directions:"Directions",
        footerLine1:"Enjoy your stay in Casablanca!",
        footerTip:"Tip: save this page on your phone to access it offline."
      }
    };

    function applyLang(lang){
      const d=DICT[lang]||DICT.fr;
      document.documentElement.lang = (lang==='en'?'en':'fr');
      $$('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); if(d[k]) el.textContent=d[k]; });
      $('#btn-fr')?.classList.toggle('active',lang==='fr');
      $('#btn-en')?.classList.toggle('active',lang==='en');
      $('#btn-fr')?.setAttribute('aria-pressed',lang==='fr');
      $('#btn-en')?.setAttribute('aria-pressed',lang==='en');
      localStorage.setItem('lang',lang);
      // Update dynamic labels
      const ownerLbl = document.getElementById('ownerBtnLabel');
      if(ownerLbl) ownerLbl.textContent = d.ownerLogin;
      const themeLbl = document.querySelector('#themeToggle [data-i18n="themeBtn"]');
      if(themeLbl) themeLbl.textContent = d.themeBtn;
    }
    $('#btn-fr')?.addEventListener('click',()=>applyLang('fr'));
    $('#btn-en')?.addEventListener('click',()=>applyLang('en'));

    /* =========================
       Clipboard & Secrets (auto re‑mask)
       ========================= */
    async function copyTextSafe(text){
      try{ if(navigator.clipboard && navigator.clipboard.writeText){ await navigator.clipboard.writeText(text); return true; } }catch(e){}
      try{ const ta=document.createElement('textarea'); ta.value=text; ta.setAttribute('readonly',''); ta.style.position='fixed'; ta.style.top='-1000px'; ta.style.opacity='0'; document.body.appendChild(ta); ta.focus(); ta.select(); const ok=document.execCommand('copy'); document.body.removeChild(ta); return !!ok; }catch(err){ return false; }
    }
    function bindSecrets(){
      $$('code[data-secret]').forEach(code=>{
        const v=code.getAttribute('data-value'); let timer=null; const mask='••••••';
        const hide=()=>{ code.textContent=mask; code.setAttribute('data-secret','true'); };
        const show=()=>{ code.textContent=v; code.removeAttribute('data-secret'); clearTimeout(timer); timer=setTimeout(hide,10000); };
        code.addEventListener('click',()=>{ if(code.hasAttribute('data-secret')) show(); else hide(); });
      });
      $$('button[data-copy]').forEach(btn=>{
        btn.addEventListener('click',async ()=>{
          const v=btn.getAttribute('data-copy');
          let toCopy=v&&v!=='#'?v:btn.previousElementSibling?.getAttribute('data-value')||btn.previousElementSibling?.textContent;
          const ok=await copyTextSafe(toCopy||''); btn.textContent= ok?'Copié ✔':'Échec copie'; setTimeout(()=>btn.textContent='Copier',1200);
        });
      });
      $$('button[data-reveal]').forEach(btn=>{ const code=btn.previousElementSibling?.previousElementSibling; if(!code) return; btn.addEventListener('click',()=>{ code.click(); }); });
    }

    /* =========================
       Photo helpers used by owner mode & gallery controls
       ========================= */
    function refreshPhotoDropsVisibility(){ $$('.photo-drop').forEach(drop=>{ drop.style.display = drop.classList.contains('has-image')? 'block' : (ownerMode?'block':'none'); }); }
    function refreshGalleryVisibility(){ const hasImages=(JSON.parse(localStorage.getItem('gallery:images')||'[]')||[]).length>0; const slider=$('#slider'), thumbs=$('#thumbs'), dots=$('#dots'); if(!slider||!thumbs||!dots) return; if(hasImages){ [slider,thumbs,dots].forEach(el=>el.classList.remove('gallery-empty')); } else { const hide=!ownerMode; [slider,thumbs,dots].forEach(el=>{ if(hide) el.classList.add('gallery-empty'); else el.classList.remove('gallery-empty'); }); } }

    /* =========================
       Init base features
       ========================= */
    applyLang(localStorage.getItem('lang')||'fr');
    restoreOwner();
    bindOwner();
    bindSecrets();

    /* =========================
       Photo uploads (persist) — reused logic
       ========================= */
    function bindPhotoDrop(drop){
      const input=drop.querySelector('input[type=file]');
      const key='photo:'+drop.dataset.photo;
      function show(dataUrl){ drop.classList.add('has-image'); drop.style.display='block'; drop.innerHTML=`<div class="photo-preview"><img alt="Photo" loading="lazy" src="${dataUrl}"><div class="photo-actions"><button class="pill" data-act="replace" ${ownerMode?'':'data-edit-only'}>Changer</button><button class="pill" data-act="remove" ${ownerMode?'':'data-edit-only'}>Supprimer</button></div></div>`; const btnReplace=drop.querySelector('[data-act="replace"]'); const btnRemove=drop.querySelector('[data-act="remove"]'); btnReplace?.addEventListener('click',()=>{ if(!ownerMode){toast('Lecture seule'); return;} input.click();}); btnRemove?.addEventListener('click',()=>{ if(!ownerMode){toast('Lecture seule'); return;} localStorage.removeItem(key); reset();}); }
      function reset(){ drop.classList.remove('has-image'); drop.innerHTML=''; const ni=document.createElement('input'); ni.type='file'; ni.accept='image/*'; ni.hidden=true; drop.appendChild(ni); const sp=document.createElement('span'); sp.textContent=drop.dataset.i18nText||'Cliquez pour ajouter une photo'; drop.appendChild(sp); ni.addEventListener('change',handleFile); drop.addEventListener('click',()=>{ if(!ownerMode){toast('Lecture seule'); return;} ni.click(); },{once:true}); drop.style.display = ownerMode ? 'block' : 'none'; }
      async function compress(file,maxW=1400){ const img=new Image(); const fr=new FileReader(); await new Promise(res=>{fr.onload=()=>{img.src=fr.result; img.onload=res;}; fr.readAsDataURL(file);}); const scale=Math.min(1,maxW/img.width); const c=document.createElement('canvas'); c.width=img.width*scale; c.height=img.height*scale; c.getContext('2d').drawImage(img,0,0,c.width,c.height); return c.toDataURL('image/jpeg',0.85); }
      async function handleFile(e){ const f=e.target.files[0]; if(!f) return; const url=await compress(f); localStorage.setItem(key,url); show(url); }
      input.addEventListener('change',handleFile); drop.addEventListener('click',()=>{ if(!ownerMode){toast('Lecture seule'); return;} input.click();}); const saved=localStorage.getItem(key); if(saved) show(saved); else reset();
    }
    $$('.photo-drop').forEach(bindPhotoDrop);

    /* ===== Hero image (persist) ===== */
    (function(){ const hero=$('#hero'); const input=$('#heroInput'); const KEY='photo:hero'; async function compress(file,maxW=1600){ const img=new Image(); const fr=new FileReader(); await new Promise(res=>{fr.onload=()=>{img.src=fr.result; img.onload=res;}; fr.readAsDataURL(file);}); const scale=Math.min(1,maxW/img.width); const c=document.createElement('canvas'); c.width=img.width*scale; c.height=img.height*scale; c.getContext('2d').drawImage(img,0,0,c.width,c.height); return c.toDataURL('image/jpeg',0.85); } function setBG(u){ hero.style.backgroundImage=`radial-gradient(120% 120% at 80% 10%, rgba(0,0,0,.35) 0%, rgba(0,0,0,.55) 60%, rgba(0,0,0,.65) 100%), url('${u}')`; } const saved=localStorage.getItem(KEY); if(saved) setBG(saved); hero.addEventListener('click',()=>{ if(!ownerMode){toast('Lecture seule'); return;} input.click();}); hero.addEventListener('keypress',e=>{ if((e.key==='Enter'||e.key===' ')){ e.preventDefault(); if(!ownerMode){toast('Lecture seule'); return;} input.click(); }}); input.addEventListener('change',async e=>{const f=e.target.files[0]; if(!f) return; const url=await compress(f); localStorage.setItem(KEY,url); setBG(url);}); })();

    /* =========================
       PWA SW gating (unchanged)
       ========================= */
    (async function setupSW(){ if(!('serviceWorker' in navigator)) return; const p=location.protocol; const isHttp=p==='https:'||p==='http:'; const isBlob=p==='blob:'; if(!isHttp||isBlob){ return; } try{ const r=await fetch('sw.js',{cache:'no-store'}); if(!r.ok){ return; } await navigator.serviceWorker.register('sw.js',{scope:'./'}); }catch(e){} })();

    /* =========================
       Galerie / Slider (with autoplay bar)
       ========================= */
    (function gallery(){ const LS_KEY='gallery:images'; let images=[]; let idx=0; let edit=false; const input=$('#gal-input'); const addBtn=$('#gal-add'); const clearBtn=$('#gal-clear'); const editBtn=$('#gal-edit'); const slides=$('#slides'); const dots=$('#dots'); const thumbs=$('#thumbs'); const prev=$('#prev'); const next=$('#next'); const autoBar=$('#autoBar'); let autoTimer=null, autoMs=5000, paused=false;
      function save(){ localStorage.setItem(LS_KEY,JSON.stringify(images)); refreshGalleryVisibility(); }
      function load(){ try{ images=JSON.parse(localStorage.getItem(LS_KEY)||'[]')||[] }catch{ images=[] } }
      function render(){ slides.innerHTML=''; dots.innerHTML=''; thumbs.innerHTML=''; images.forEach((im,i)=>{ const s=document.createElement('div'); s.className='slide'; s.innerHTML=`<img alt="Photo ${i+1}" loading="lazy" src="${im.src}">`+(im.caption?`<div class="caption">${im.caption}</div>`:''); if(edit){ const badge=document.createElement('div'); badge.className='badge-edit'; const del=document.createElement('button'); del.className='mini'; del.textContent='Supprimer'; del.onclick=()=>{ images.splice(i,1); if(idx>=images.length) idx=Math.max(0,images.length-1); save(); render(); }; const cap=document.createElement('button'); cap.className='mini'; cap.textContent='Légende'; cap.onclick=()=>{ const c=prompt('Légende de la photo :',im.caption||''); if(c!==null){ images[i].caption=c; save(); render(); } }; badge.appendChild(cap); badge.appendChild(del); s.appendChild(badge); } slides.appendChild(s); const d=document.createElement('div'); d.className='dot'+(i===idx?' active':''); d.tabIndex=0; d.onclick=()=>go(i); d.onkeydown=(e)=>{ if(e.key==='Enter'||e.key===' ') go(i); }; dots.appendChild(d); const t=document.createElement('div'); t.className='t'+(i===idx?' active':''); t.innerHTML=`<img alt="Miniature ${i+1}" loading="lazy" src="${im.src}">`; t.onclick=()=>go(i); thumbs.appendChild(t); }); update(); refreshGalleryVisibility(); }
      function update(){ slides.style.transform=`translateX(-${idx*100}%)`; [...dots.children].forEach((n,i)=>n.classList.toggle('active',i===idx)); [...thumbs.children].forEach((n,i)=>n.classList.toggle('active',i===idx)); prev.style.display=images.length>1?'grid':'none'; next.style.display=images.length>1?'grid':'none'; resetProgress(); }
      function go(i){ if(!images.length) return; idx=(i+images.length)%images.length; update(); }
      prev.onclick=()=>go(idx-1); next.onclick=()=>go(idx+1);
      let startX=null,delta=0; slides.addEventListener('touchstart',e=>{ if(!images.length) return; startX=e.touches[0].clientX; delta=0; paused=true; },{passive:true}); slides.addEventListener('touchmove',e=>{ if(startX==null) return; delta=e.touches[0].clientX-startX; slides.style.transform=`translateX(calc(-${idx*100}% + ${delta}px))`; },{passive:true}); slides.addEventListener('touchend',()=>{ if(Math.abs(delta)>60){ go(idx+(delta<0?1:-1)); } else { update(); } startX=null; paused=false; });
      document.addEventListener('keydown',e=>{ if(e.key==='ArrowLeft') prev.click(); if(e.key==='ArrowRight') next.click(); });
      addBtn && (addBtn.onclick=()=>{ if(!ownerMode){toast('Lecture seule'); return;} input.click(); });
      input.onchange=async e=>{ const files=[...e.target.files]; if(!files.length) return; for(const f of files){ const src=await compress(f,1600); images.push({src,caption:''}); } save(); render(); input.value=''; };
      clearBtn && (clearBtn.onclick=()=>{ if(!ownerMode){toast('Lecture seule'); return;} if(confirm('Supprimer toutes les photos ?')){ images=[]; idx=0; save(); render(); }});
      editBtn && (editBtn.onclick=()=>{ if(!ownerMode){toast('Lecture seule'); return;} edit=!edit; editBtn.textContent = (localStorage.getItem('lang')||'fr')==='en' ? `Edit mode: ${edit?'ON':'OFF'}` : `Mode édition : ${edit?'ON':'OFF'}`; render(); });
      async function compress(file,maxW=1400){ const img=new Image(); const fr=new FileReader(); await new Promise(res=>{fr.onload=()=>{img.src=fr.result; img.onload=res;}; fr.readAsDataURL(file);}); const scale=Math.min(1,maxW/img.width); const c=document.createElement('canvas'); c.width=img.width*scale; c.height=img.height*scale; c.getContext('2d').drawImage(img,0,0,c.width,c.height); return c.toDataURL('image/jpeg',0.85); }
      function resetProgress(){ if(!autoBar) return; autoBar.style.transition='none'; autoBar.style.width='0%'; void autoBar.offsetWidth; autoBar.style.transition=`width ${autoMs}ms linear`; if(autoTimer) clearTimeout(autoTimer); if(!paused && images.length>1){ requestAnimationFrame(()=>{ autoBar.style.width='100%'; autoTimer=setTimeout(()=>{ go(idx+1); }, autoMs); }); } }
      $('#slider')?.addEventListener('mouseenter',()=>{ paused=true; if(autoTimer) clearTimeout(autoTimer); });
      $('#slider')?.addEventListener('mouseleave',()=>{ paused=false; resetProgress(); });
      load(); render();
    })();

    /* =========================
       Map config & wiring (unchanged)
       ========================= */
    (function setupMap(){ const CONFIG={ placeQuery:'H82G+63W, Rte du complexe Administratif, Casablanca 20240, Maroc' }; const iframe=document.getElementById('mapFrame'); const openBtn=document.getElementById('mapOpen'); const dirBtn=document.getElementById('mapDirections'); let urlEmbed,urlOpen,urlDir; if (typeof CONFIG.lat==='number' && typeof CONFIG.lng==='number'){ const {lat,lng}=CONFIG; urlEmbed=`https://www.google.com/maps?q=${lat},${lng}&z=16&output=embed`; urlOpen=`https://www.google.com/maps?q=${lat},${lng}&z=16`; urlDir=`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`; } else { const q=encodeURIComponent(CONFIG.placeQuery||'Casablanca, Morocco'); urlEmbed=`https://www.google.com/maps?q=${q}&output=embed`; urlOpen=`https://www.google.com/maps?q=${q}`; urlDir=`https://www.google.com/maps/dir/?api=1&destination=${q}`; } iframe.src=urlEmbed; openBtn.href=urlOpen; dirBtn.href=urlDir; })();

    /* =========================
       Owner tools (hash)
       ========================= */
    (function ownerTools(){ const plain=$('#pwdPlain'); const btnGen=$('#btnGenHash'); const out=$('#hashOut'); const btnCopy=$('#btnCopyHash'); const btnApply=$('#btnApplyLocal'); if(!plain||!btnGen||!out||!btnCopy||!btnApply) return; btnGen.addEventListener('click', async ()=>{ const v=(plain.value||'').trim(); if(!v){ toast('Entrez un mot de passe'); plain.focus(); return; } const h=await sha256(v); out.textContent=h; toast('Hash généré'); }); btnCopy.addEventListener('click', async ()=>{ const h=out.textContent.trim(); if(!h||h==='—'){ toast('Rien à copier'); return; } const ok=await copyTextSafe(h); toast(ok?'Copié ✔':'Échec copie'); }); btnApply.addEventListener('click', ()=>{ const h=out.textContent.trim(); if(!h||h==='—'){ toast('Génère le hash d’abord'); return; } localStorage.setItem(LS_OWNER_HASH,h); toast('Override local activé'); }); })();

    /* =========================
       Patch: keep owner button label & icon intact when toggling
       ========================= */
    (function fixOwnerLabel(){
      const origSetOwnerUI = setOwnerUI;
      setOwnerUI = function(on){
        ownerMode = !!on;
        document.body.classList.toggle('owner-on', ownerMode);
        const lbl = document.getElementById('ownerBtnLabel');
        if(lbl){ lbl.textContent = (localStorage.getItem('lang')||'fr')==='en' ? (ownerMode? 'Owner logout':'Owner login') : (ownerMode? 'Déconnexion propriétaire':'Connexion propriétaire'); }
        refreshPhotoDropsVisibility();
        refreshGalleryVisibility();
      }
    })();
  </script>
</body>
</html>
